# 로드밸런싱

## 로드밸런싱

- 여러 서버에 부하를 나누어주는 것!
- 4계층에서 로드밸런서에 의해 동작
- 로드 밸런서가 제공하는 기능
    - 포트 주소를 확인하는 동시에 각 웹서버로 IP 주소를 변경하여 전송
    - 서비스 헬스 체크 : 부하분산을 하는 각 서버의 상태를 주기적으로 확인하여 정상적인 서비스쪽으로만 부하를 분산
- 로드밸런서는 L4, L7 스위치가 대표적이다.

## 로드밸런서가 서버를 선택하는 방식

- 라운드로빈 ( Round Robin )
    - 특별한 규칙 없이 순차적으로 분산
    - 모든 장비의 누적 세션수가 같아질 수 밖에!
- 최소 접속 방식 ( Least Connections )
    - 서버가 가진 세션 부하를 확인하고 가장 적은 세션을 가진 서버 선택
    - 각 장비에서 활성화되고있는 세선 수가 비슷해진다.
- 해싱 ( Source )
    - 서버의 부하를 고려하지 않고 사용자의 IP를 해싱하여 서버 선택
    - 같은 해시 알고리즘을 선택한다면 항상 같은 서버에 분배되므로 클라이언트가 항상 같은 서버에 접속하도록 보장하고싶을 때 이용한다.
- 라운드로빈과 최소접속방식은 비슷한 비율로 분산시킬 수 있지만 같은 클라이언트가 서로 다른 서버에 접속할 가능성이 있어 각 서버에서 세션을 유지하고 있는 서비스 등에서는 비정상적으로 작동할 수 있다.
- 해싱 방식은 항상 동일한 서버를 보장함으로써 세션을 유지하는 서버에서도 정상적으로 작동하지만 해싱 알고리즘의 결과값이 특정한 값으로 치우친다면 부하분산비율도 한쪽으로 치우치게 된다.
- 라운드로빈이나 최소접속방식에 스티키(sticky)라는 옵션을 통해 한번 접속한 연결을 지속적으로 유지함으로써 세션 관련 문제를 해결할 수도 있다! → 해당 연결은 타임아웃이 있어 타임아웃 이후에는 다시 다른 서버로 연결될 수 있다.
