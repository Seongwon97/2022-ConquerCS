# TCP란?
## 무엇인가?
- 네트워크 통신에서의 안정적인 연결을 구축하고, 신뢰성있는 전송을 보장하는 프로토콜

## 왜 쓰는가?
- reliable network를 보장하기 위해
  - 손실: packet(3계층 PDU)이 손실될 수 있는 문제
  - 순서 바뀜: packet의 순서가 바뀔 수 있는 문제
  - 혼잡(congestion): 네트워크가 혼잡한 문제
  - 과부하(overload): 수신자가 과도한 로드를 요청받는 문제
  
## 연결 
### 연결 성립 - 3 way handshake
- TCP는 정확한 전송을 보장한다. 접속을 성립하기 위한 과정을 3 way handshake이라 한다.
#### 과정
1. 클라이언트가 서버에게 Sequence Number와 함께 SYN 패킷을 보낸다.(ex: seq = 1000)
2. 서버가 SYN을 받고 클라이언트로 받았다는 신호인 ACK과 함께 클라이언트의 다음 Sequence를 보내고, 서버의 Sequence Number와 함께 SYN 패킷을 보낸다.(ex: seq = 2000, ACK = 1000 + 1)
3. 클라이언트는 서버의 응답을 받아 ACK에서 요청된 Sequence Number와 함께 ACK을 보낸다.
(ex: ACK = 1001)

- 이렇게 3번의 통신이 끝나면 연결이 성립된다.

### 연결 해제
1. 클라이언트는 서버에게 연결을 종료한다는 FIN 플래그를 보낸다.
2. 서버는 FIN을 받고, 확인했다는 ACK를 클라이언트에게 보낸다. 그리고 모든 데이터를 보내기 위해 CLOSE_WAIT 상태가 된다.
3. 데이터를 모두 보냈다면, 연결이 종료되었다는 FIN 플래그를 클라이언트에 보낸다.
4. 클라이언트는 FIN을 받고, 확인했다는 ACK를 서버에 보낸다. 아직 서버로부터 받지 못한 데이터가 있을 수 있으므로 TIME_WAIT 상태에서 기다린다.
- 서버는 ACK을 받은 이후 소켓을 닫는다.
- TIME_WAIT 시간이 끝나면 클라이언트도 닫는다.
- 이렇게 4번의 통신이 끝나면 연결이 해제된다.

## 제어
### 흐름 제어(Flow Control)
- 송신측의 속도가 수신측의 읽기(Read) 속도보다 빠를 경우 문제가 생긴다.
- 이를 위해 송신측의 데이터 전송량을 수신측에 따라(Window Size) 조절한다.
- 일반적의로 Stop and Wait과 Sliding Window를 통해 제어한다.
  - Stop and Wait: 적절한 ACK 신호를 받지 못한 경우 송신측에서 데이터를 보내지 않고 대기한다.
  - Sliding Window: 수신측에서 보낸 Window Size 만큼 확인 응답없이 세그먼트를 전송할 수 있게 하여 데이터 흐름을 동적으로 조절한다.
  
### 혼잡 제어(Congestion Control)
- 네트워크의 처리 지연으로 중복된 요청이 발생할 경우 송신측에서 보내는 데이터 전송속도를 조절하는 것을 말한다.
- 흐름 제어가 송신측과 수신측 사이의 전송속도를 다루는데 반해, 혼잡 제어는 호스트와 라우터를 포함한 보다 넓은 관점에서 전송 문제를 다룬다.