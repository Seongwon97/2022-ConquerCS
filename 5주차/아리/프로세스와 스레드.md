# 프로세스와 스레드

## 프로세스와 스레드

- 프로세스 vs 스레드
    - 프로세스 : 메모리 상에서 질행중인 프로그램
    - 스레드 : 프로세스 안에서 실행되는 여러 흐름의 단위
    - 즉, 하나의 프로세스는 1개 이상의 스레드를 보유하고 있다.
- 프로세스는 각각 별도의 주소공간에 독립적으로 할당되어있다.
    - code : 소스코드 저장
    - data : 전역변수, 정적변수 배열 등 저장 → 초기화 된 데이터는 data에, 초기화 되지 않은 데이터는 bss에 저장
    - heap : 동적할당 된 데이터 저장 ( new() , malloc() 등 )
    - stack : 지역변수, 매개변수, 리턴 값을 임시로 저장
- 스레드는 stack 만 따로 할당받고 나머지 영역은 각 프로세스 내의 다른 스레드들과 공유한다.
- 프로세스 vs 프로세서
    - 프로세스
        - 실행되는 프로그램 그 자체
        - 스스로 무언가를 처리 불가능
    - 프로세서
        - 하드웨어적으로는 특정 작업을 수행하는 하드웨어 단위 ( CPU, 라우터, 스위치 등 )
        - 소프트웨어적으로는 데이터를 변환하는 데이터 처리 시스템 ( 워드, 컴파일러, 어셈블러 등 )
        - 스스로 무언가를 처리 가능
    - 즉, 작업 과정이 저장된 프로그램을 메모리에 적재하여 실행/대기 중인 것이 프로세스이고 이는 프로세서에 의해 실행된다.

## 멀티 프로세스

- 하나의 컴퓨터에 여러개의 CPU가 장착됨으로써 하나 이상의 프로세스를 동시에 ( 병렬적으로 ) 처리하는 것
- 장점
    - CPU가 분리됨으로써 메모리도 함께 분리되어 메모리 침범 문제가 발생하지 않는다.
- 단점
    - 각각 독립된 메모리를 가짐으로서 작업량이 많을수록 오버헤드가 발생한다.

      → 캐시 메모리 초기화 등과 같은 작업은 매우 무겁기 때문!
    - context switch으로 인한 성능저하가 발생한다.

      → 동작중이던 프로세스가 대기됨에따라 상태를 저장하고, 대기하고있던 다른 프로세스의 상태를 불러는 과정.

## 멀티 스레드

- 하나의 응용프로그램에서 여러 스레드를 구성하여 각 스레드가 하나의 작업을 처리함으로써 하나 이상의 스레드를 동시에 ( 병렬적으로 ) 처리하는 것
- 장점
    - stack 공간만 독립적으로 이용하고, 나머지 메모리는 공유함으로써 시간, 자원 손실이 적고 공유변수를 이용할 수 있다.
- 단점
    - 하나의 스레드가 데이터를 망가뜨리면 모든 스레드가 작동이 불가능해져 안전하지 않다.

## 동기화

- 공유 자원에 두 개 이상의 프로세스가 동시에 접근하여도 데이터의 일관성 ( data consistency ) 을 보장하는 것
- 경쟁상황 ( Race Condition )
    - 여러 프로세스가 공유자원에 접근할 때 프로세스의 실행 순서에 따라 결과값이 달라짐으로써 data inconsistency가 발생할 수 있는 상황
    - 제일 나중에 실행되는 프로세스에 의해 최종 값이 결정된다.
- The Critical-Section Problem ( 임계 구역 문제 )
    - Critical-Section : 공유 자원을 접근하는 코드 영역
    - The Critical-Section Problem : critial section에 두 개 이상의 프로세스가 접근함으로써 데이터 일관성이 보장되지 않을 수 있는 문제 상황
- The Critical-Section Problem 을 해결하기 위한 3가지 요구 조건
    - 상호 배제 ( Mutual Exclusion )
        - 한 프로세스가 critial section에 진입하면 다른 프로세스는 critial section에 진입하지 않는다.
    - 진행 ( Progress )
        - critial section에 진입하려는 다른 프로세스가 없다면 대기 없이 바로 진입할 수 있어야 한다.
    - 한정된 대기 ( Bounded Waiting )
        - 상호 배제를 통해 진입하지 못한 프로세스도 언젠간은 진입할 수 있도록 보장되어야 한다.
        - 진입을 위해 무한히 기다리지 않아야 한다!
- The Critical-Section Problem 해결 방법
    - Mutex ( 상호배제 )
        - Mutual Exclusion의 줄임말
        - lock을 가진 프로세스만이 공유자원에 접근하고, 작업이 끝났다면 unlock 하여 lock을 반환한다.
        - 하나의 자원에 대해서만 적용할 수 있다.
    - Semaphore ( 세마포어 )
        - 군대에서 사용하는 수신호 라는 뜻
        - P와 V라는 두가지 동작을 통해 공유자원을 보호한다.
        - critial section에 접근하지 못하는 경우 대기줄(list)에 추가되는데, 이는 대부분 큐로 구현되어 있다.

      < P >

        - acquire의 의미
        - value값을 감소시키며 value값이 0보다 작으면 critial section에 어떤 프로세스가 접근해있음을 뜻한다. 따라서 현재 프로세스는 접근이 블가능함을 알 수 있다.
        - 현재 프로세스를 list에 추가한 뒤 block함으로써 대기줄에 자신을 추가한다.

      < V >

        - release의 의미
        - value값을 증가시키며 value값이 0보다 작거나 같으면 진입 대기중엔 프로세스가 존재함을 뜻한다.
        - list에서 하나를 꺼내어 수행될 수 있도록 한다.
