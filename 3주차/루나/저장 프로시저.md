## 저장 프로시저

- 일련의 작업 절차를 하나의 함수처럼 실행하기 위해 정리해서 저장한 것
- **여러 SQL문을 묶어서 미리 정의해 두고 하나의 요청으로 실행할 수 있음**
- **자주 사용되는 복잡한 작업**들을 간단하게 실행 할 수 있음
- Application 에서 직접 모든 작업을 요청하지 않아도 되기 때문에 부하가 줄어들고 보안이 향상됨
- 단, 검증되지 않은 저장 프로시저를 실행하는 것은 매우 위험함
- MySQL은 5.0버전부터 사용 가능

![https://docs.oracle.com/cd/B13789_01/java.101/b12021/img/call_sto.gif](https://docs.oracle.com/cd/B13789_01/java.101/b12021/img/call_sto.gif)

프로시저를 만들어두면, 애플리케이션에서 여러 상황에 따라 해당 쿼리문이 필요할 때 인자 값만 전달하여 쉽게 원하는 결과물을 받아낼 수 있다.

### **프로시저 생성 및 호출**

```sql
CREATE OR REPLACE PROCEDURE 프로시저명(변수명1 IN 데이터타입, 변수명2 OUT 데이터타입) -- 인자 값은 필수 아님
IS
[
변수명1 데이터타입;
변수명2 데이터타입;
..
]

BEGIN  //->  ****저장 프로시저 범위의 시작
 필요한 기능; -- 인자값 활용 가능
END; // -> 저장 프로시저 범위의 끝

EXEC 프로시저명; -- 호출
```

### **예시1 (IN)**

```sql
CREATE OR REPLACE PROCEDURE test( name IN VARCHAR2 ) 
IS
	msg VARCHAR2(5) := '내 이름은';
BEGIN 
	dbms_output.put_line(msg||' '||name); 
END;

EXEC test('규글');
```

### **예시2 (OUT)**

```sql
CREATE OR REPLACE PROCEDURE test( name OUT VARCHAR2 ) 
IS
BEGIN 
	name := 'Gyoogle'
END;

DECLARE
out_name VARCHAR2(100);

BEGIN
test(out_name);
dbms_output.put_line('내 이름은 '||out_name);
END;
```

## **프로시저 장점**

1. **최적화 & 캐시**

   프로시저의 최초 실행 시 최적화 상태로 컴파일이 되며, 그 이후 프로시저 캐시에 저장된다.

   만약 해당 프로세스가 여러번 사용될 때, 다시 컴파일 작업을 거치지 않고 캐시에서 가져오게 된다.

2. **유지 보수**

   작업이 변경될 때, 다른 작업은 건드리지 않고 프로시저 내부에서 수정만 하면 된다. (But, 장점이 단점이 될 수도 있는 부분이기도.. )

3. **트래픽 감소**

   클라이언트가 직접 SQL문을 작성하지 않고, 프로시저명에 **매개변수만 담아 전달**하면 된다. 즉, SQL문이 서버에 이미 저장되어 있기 때문**에 클라이언트와 서버 간 네트워크 상 트래픽이 감소**된다.

4. **보안**

   프로시저 내에서 참조 중인 테이블의 접근을 막을 수 있다.


## **프로시저 단점**

1. **호환성**

   구문 규칙이 SQL / PSM 표준과의 호환성이 낮기 때문에 코드 자산으로의 재사용성이 나쁘다.

2. **성능**

   문자 또는 숫자 연산에서 프로그래밍 언어인 C나 Java보다 성능이 느리다.

   프로시저 내부에 연산이 포함될 경우 CPU 점유율이 높아지고 실행 시간도 길어지므로 LOCK이 걸려있을 경우 병목이 될 확률이 높아지진다.

3. **디버깅**

   에러가 발생했을 때, 어디서 잘못됐는지 디버깅하는 것이 힘들 수 있다.

4. **버전 관리**

   배포 절차가 따로 없으므로 버전 관리가 어렵다.


## 결론

저장 프로시저는 특별한 배포 절차 없이 사용하기에는 좋으나 프로그램 규모가 커질수록 단점이 더욱 부각될 수 있다.

그러나 비즈니스, 업무 특성, 여러 이해 관계에 따라 프로시저를 사용할 수 밖에 없는 경우도 있다. 또한 프로시저의 장점을 잘 살리면 개발 생산성을 올릴 수 있기에 상황에 맞게 적절히 사용하면 좋을 것이다.