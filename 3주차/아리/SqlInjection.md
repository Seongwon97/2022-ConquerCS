# Sql Injection

## Sql Injection이란?

해커에 의해 조작된 SQL 쿼리문이 데이터베이스에 그대로 전달되어 비정상적인 명령을 실행시키는 공격기법

## 공격 방법

- 사용자의 입력창에 올바른 입력이 아니라 쿼리문을 입력한다.
- 에러를 유발하여 예외메시지를 확인하고, 이를 통해 데이터베이스 구조를 유추하여 해킹에 활용한다.

## 방어 방법

- 사용자에게 입력을 받을 때 검증로직을 추가! 입력값에 사전에 설정된 특수 문자들이 포함되어있다면 요청을 거절한다.
- SQL 오류 발생시 예외 메시지가 사용자에게 노출되지 않도록 데이터베이스 접근 권한을 높인다.
- PreparedStatement를 활용한다.
    - statement를 활용하는 경우 매번 sql을 파싱하지만, PreparedStatement의 경우 최초 한번만 파싱을 진행하고, 이후에는 파싱 과정이 생략된다. 파싱한 결과는 메모리에 저장해두고 변경되는
      부분은 변수로 선언하여 매번 다른 값을 바인딩 한다.
    - 즉, PreparedStatement에서는 매번 sql 문법을 이용하는 것이 아니라 내부의 인터프리터 혹은 컴파일 언어로 처리하기 때문에 문법적인 의미를 가질 수 없다.
    - 따라서 변수에 sql 쿼리를 입력하더라도 문법적인 의미가 없기 때문에 공격이 수행되지 않는다.

## 언어별 - Sql Injection 위험성

- MyBatis
    - ${} - Query String을 통해 쿼리문에 직접 입력되기 때문에 공격가능
    - #{} - 파라미터로 바인딩하기 때문에 공격이 수행X
- JPA
    - 파라미터로 바인딩하고있다고 공식적으로 밝혀져있기 때문에 공격이 수행되지 않는다.
    - 하지만, sql 쿼리를 직접 entityManager에게 전달한다면 위험할 수 있다.
