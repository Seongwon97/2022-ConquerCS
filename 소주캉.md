# OSI 7 
# 무엇인가?
![OSI 7 layer](https://velog.velcdn.com/images/sojukang/post/7764cb43-5935-4c9b-b295-01fc47c7ce63/image.png)

OSI(Open Systems Interconnection): 네트워크 통신을 7개의 계층으로 나눈 모델.

# 왜 쓰는가?
네트워크 통신의 각 관심사를 나누어 파악하기 위해. 각 계층을 추상화하여 개념을 파악하기 쉽게 한다.

# 각 계층 상세 
Application ~ Session 계층까지를 Application Layer(상위 계층),
Transport ~ Physical 계층까지를 Data flow Layer(하위 계층)으로 나누기도 한다.
계층의 구분은 데이터를 만드는 어플리케이션 부분과 이 데이터를 전달하는 하부 계층으로 구분하는 게 목적이다.
## Application Layer
### Application(7)
#### 특징
- 사용자 입, 출력 부분을 정의

#### 프로토콜
- HTTP, SMP, SMTP

### Presentation(6)
#### 특징
- 다른 어플리케이션이나 시스템간의 통신을 돕기 위해 통일된 형식으로 변환

#### 프로토콜
- TLS, SSH

### Session(5)
#### 특징
- 양 끝단의 응용 프로세스 연결, 유지, 종료

#### 프로토콜
- L2TP, PPTP, NFS

## Data Flow Layer
### Transport(4)
#### 목적
- 실제로 데이터들이 정상적으로 잘 보내지도록 확인

#### 특징
- 패킷이 유실되면 재전송을 요청할 수 있다.
  - `패킷이란?` 하나의 통신이 회선 전체를 점유하지 않고 동시에 여러 단말이 통신하도록 데이터를 쪼갠 단위.
- 순서가 바뀌었을 때 바로잡아준다.
- port 번호를 통해 상위 어플리케이션을 구분한다.

#### 프로토콜
- TCP: 신뢰성, 연결지향적
- UDP: 비신뢰성, 비연결성, 실시간

#### 주요 장비 
port 번호와 sequence number, ACK number 를 이용해 부하를 분산하거나 보안 정책을 수립해 패킷을 통과, 차단하는 기능 수행

- Load Blancer
- Fire Wall

### Network(3)
#### 목적
- 논리적인 주소 정보를 정의하고 통신이 되도록 하는데 초점

#### 특징
- IP 주소는 네트워크 주소와 호스트 주소 부분으로 나뉨

#### 프로토콜
- ARP, IPv4, IPv6, NAT

#### 주요 장비
- Router: IP 주소를 사용해 최적 경로를 찾아 패킷 전송

### Datalink(2)
#### 목적
- 실제 물리적 주소 정보를 정의하고 정확한 주소로 통신이 되도록 하는데 초점

#### 특징
- 전기 신호를 모아 특정 데이터 형태로 처리 
- 데이터에 관한 에러 탐지, 고침
- 이더넷 기반 네트워크에서는 에러 탐지 역할 수행
- MAC 주소를 기반으로 통신

#### 주요 장비
- NIC(Network Interface Card, Lan Card)
- Switch

### Phisical(1)
#### 목적
- 들어온 전기 신호를 잘 전달

#### 특징
- 물리적 연결과 관련된 정보 정의
- 주로 전기 신호 전달

#### 주요 장비
- Hub, Repeater: 네트워크 통신을 중재
- Cable, Connector: 케이블 본체를 구성
- Tranceiver: 랜 카드와 케이블 연결
- TAP: Network monitoring과 Packet 분석을 위해 전기 신호를 다른 장비로 복제


# TCP/IP와 차이는?
다소 개념적인 OSI 7 계층에 비하여 실제 쓰이는 프로토콜별로 나누어 현실에 쉽게 대응된다.
OSI 7 계층은 참조형 모델이고 실제로 사용하는 프로토콜은 TCP/IP 프로토콜 스택으로 구현된다.

# TCP란?
## 무엇인가?
- 네트워크 통신에서의 안정적인 연결을 구축하고, 신뢰성있는 전송을 보장하는 프로토콜

## 왜 쓰는가?
- reliable network를 보장하기 위해
  - 손실: packet(3계층 PDU)이 손실될 수 있는 문제
  - 순서 바뀜: packet의 순서가 바뀔 수 있는 문제
  - 혼잡(congestion): 네트워크가 혼잡한 문제
  - 과부하(overload): 수신자가 과도한 로드를 요청받는 문제
  
## 연결 
### 연결 성립 - 3 way handshake
- TCP는 정확한 전송을 보장한다. 접속을 성립하기 위한 과정을 3 way handshake이라 한다.
#### 과정
1. 클라이언트가 서버에게 Sequence Number와 함께 SYN 패킷을 보낸다.(ex: seq = 1000)
2. 서버가 SYN을 받고 클라이언트로 받았다는 신호인 ACK과 함께 클라이언트의 다음 Sequence를 보내고, 서버의 Sequence Number와 함께 SYN 패킷을 보낸다.(ex: seq = 2000, ACK = 1000 + 1)
3. 클라이언트는 서버의 응답을 받아 ACK에서 요청된 Sequence Number와 함께 ACK을 보낸다.
(ex: ACK = 1001)

- 이렇게 3번의 통신이 끝나면 연결이 성립된다.

### 연결 해제
1. 클라이언트는 서버에게 연결을 종료한다는 FIN 플래그를 보낸다.
2. 서버는 FIN을 받고, 확인했다는 ACK를 클라이언트에게 보낸다. 그리고 모든 데이터를 보내기 위해 CLOSE_WAIT 상태가 된다.
3. 데이터를 모두 보냈다면, 연결이 종료되었다는 FIN 플래그를 클라이언트에 보낸다.
4. 클라이언트는 FIN을 받고, 확인했다는 ACK를 서버에 보낸다. 아직 서버로부터 받지 못한 데이터가 있을 수 있으므로 TIME_WAIT 상태에서 기다린다.
- 서버는 ACK을 받은 이후 소켓을 닫는다.
- TIME_WAIT 시간이 끝나면 클라이언트도 닫는다.
- 이렇게 4번의 통신이 끝나면 연결이 해제된다.

## 제어
### 흐름 제어(Flow Control)
- 송신측의 속도가 수신측의 읽기(Read) 속도보다 빠를 경우 문제가 생긴다.
- 이를 위해 송신측의 데이터 전송량을 수신측에 따라(Window Size) 조절한다.
- 일반적의로 Stop and Wait과 Sliding Window를 통해 제어한다.
  - Stop and Wait: 적절한 ACK 신호를 받지 못한 경우 송신측에서 데이터를 보내지 않고 대기한다.
  - Sliding Window: 수신측에서 보낸 Window Size 만큼 확인 응답없이 세그먼트를 전송할 수 있게 하여 데이터 흐름을 동적으로 조절한다.
  
### 혼잡 제어(Congestion Control)
- 네트워크의 처리 지연으로 중복된 요청이 발생할 경우 송신측에서 보내는 데이터 전송속도를 조절하는 것을 말한다.
- 흐름 제어가 송신측과 수신측 사이의 전송속도를 다루는데 반해, 혼잡 제어는 호스트와 라우터를 포함한 보다 넓은 관점에서 전송 문제를 다룬다.
 
# UDP
## 무엇인가?
- UDP(User Datagram Protocol): OSI 분류상 4계층(Transport Layer)으로 데이터를 데이터그램 단위로 처리하는 프로토콜이다.
- 비연결형, 신뢰성 없는 전송 프로토콜이다.
  - 비연결형: 연결을 유지하는 과정이 없다.
  - 비신뢰성: 데이터의 순서, 정확성 등 무결성을 보장하지 않는다.
 
## 왜 쓰는가?
- 데이터의 처리가 TCP보다 현저히 빠르면서도 IP 목적지를 정확하게 찾아갈 수 있다.
- 실시간 스트리밍이나 회의에서 사용한다.

## UDP Header에 담기는 내용은?
- Source Port: 시작 포트
- Destination Port: 도착지 포트
- Length: 길이
- Checksum: 오류 검출
  - 중복 검사의 한 형태로, 오류 정정을 통해 송신된 자료의 무결성을 보호한다.
  
## DNS에서 UDP를 사용하는 이유?
DNS query는 single UDP request와 server의 single UDP reply로 구성된다.
- DNS Request의 양이 작으므로 UDP Request에 담을 수 있다.
  - DNS Request는 UDP segment에 들어갈 정도로 작다.
- 3 way handshaking으로 연결을 생성, 유지할 필요가 없다.
  - Protocol overhead가 TCP에 비해 작다.
- Reliability는 Application Layer에서 timeout이나 resend 작업을 통해 보강할 수 있다.

### DNS 서버간 요청
- Zone transfer(DNS 서버간 요청)인 경우 데이터의 크기가 512bytes를 넘거나 통신의 정확성이 중요하여 TCP를 사용하는 경우가 있다.

# 대칭키(Symmetric Key)
## 무엇인가?
- 암호화와 복호화에 같은 암호키를 사용하는 알고리즘

## 장점은?
- 동일한 키를 주고받기 때문에 간단하며 빠르다.

## 단점은?
- 대칭키 전달과정에서 탈취당하면 모든 암호화, 복호화가 가능하므로 상대적으로 취약하다.

# 비대칭키(Asymmetric Key)
## 무엇인가?
- 암호화와 복호화에 사용하는 암호키를 분리한 알고리즘.

## 특징은?
- 암호화 하는 키와 복호화하는 키가 다르기 떄문에 대칭키에 비해 보안성이 높으나 과정이 상대적으로 복잡하고 오래 걸린다.

# 공개키(Public Key)
## 무엇인가?
- 일반적으로 기밀이 유지되어야 하는 키와 달리 보안 없이 자유롭게 공개하는 키이다.

## 특징은?
- 단독으로 쓰이지는 않으며 비밀키와 쌍을 이루어 비대칭키를 이룬다.

# 공개키 + 비대칭키
## 무엇인가?
- 자신이 가지고 있는 고유한 비밀키로만 복호화할 수 있는 공개키를 대중에 공개한다.

## 특징은?
- 대칭키의 키 분배 문제를 해결하기 위해 고안됨
  - 대칭키일 때 송수신자만 키를 알아야하므로 분배가 복잡하고 어렵지만 공개키와 비밀키로 분리할 경우, 공개키만 공개하면 된다.
 
## 과정은?
- A가 웹 상에 공개된 B의 공개키를 이용해 평문을 암호화하여 B에게 보낸다.
- B는 자신의 비밀키로 복호화한 평문을 확인, A의 공개키로 응답을 암호화하여 A에게 보낸다.
- A는 자신의 비밀키로 암호화된 응답문을 복호화한다. 

## 단점은?
- Confidentiality만 보장해줄 뿐 Integrity나 Authenticity는 보장해주지 못한다.
  - `Confidentiality`: 기밀성, 정보를 인가된 사용자에게만 공개하는 성질
  - `Integrity`: 무결성, 데이터의 변조를 막아 정상적 상태로 유지하는 성질
  - `Authenticity`: 인증성, 사용자가 인증된 사용자인지, 자료의 출처가 신뢰할만한지 확인할 수 있는 성질
- 대칭키에 비해 암호화 복호화가 매우 복잡하다.

## 대안은?
- 위의 단점을 극복하기 위해 
- 인증서 + 해싱 + 대칭키 - 비대칭키 혼합된 방식인 TLS 등장

# 로드 밸런싱
# 무엇인가?
둘 이상의 서버(자원)에 요청(작업)을 나누는 것

# 왜 쓰는가?
## 문제
- 하나의 자원만 존재할 경우 문제 발생하면 전체 시스템에 장애가 생긴다
- 자원의 성능을 높이는 scale-up의 경우 성능에 따라 증가의 효과가 감소하는 수확체감이 발생한다.

# 해결
- Load Balancer를 클라이언트와 서버 사이에 두고 여러 서버에 부하를 나눈다. 
  - scale-out: 서버의 성능이 아니라 개수를 늘려 더 많은 트래픽을 처리할 수 있는 확장.
- 주로 OSI 7 Layer의 7 계층의 Load Balancer, 4 계층의 Load Balancer가 쓰인다.

## 알고리즘 
- 라운드 로빈(Round Robin, RR): 일정 시간마다 부하를 처리할 서버를 바꿔가며 분산한다.
- Least Connections: 커넥션 개수가 가장 작은 서버를 우선 선택한다. 트래픽으로 인해 세션이 길어지는 경우 권장한다.
- Hashing: 사용자 IP를 해싱하여 분배한다. 특정 사용자가 항상 같은 서버로 연결되는 것을 보장한다.

## Load Balancer 장애 대비
- Load Balancer 자체에도 장애가 발생할 수 있기 때문에 이중화 혹은 여러 계층에 도입하여 대비한다. 

# 참고
[gyoogle.dev](https://gyoogle.dev/blog/computer-science/network/OSI%207%EA%B3%84%EC%B8%B5.html)
[IT 엔지니어를 위한 네트워크 입문](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9791165213183)
